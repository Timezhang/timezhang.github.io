<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="基于http:&#x2F;&#x2F;aospxref.com&#x2F;android-11.0.0_r21&#x2F; 权限配置重要的宏binder相关的selinux宏定义在system&#x2F;sepolicy&#x2F;public&#x2F;te_macros中 binder_service使用typeattribute把某个service的域(domain)标记成一个binder service域，在定义binder s">
<meta property="og:type" content="article">
<meta property="og:title" content="binder中的selinux权限">
<meta property="og:url" content="http://example.com/2022/04/20/binder%E4%B8%AD%E7%9A%84selinux%E6%9D%83%E9%99%90/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="基于http:&#x2F;&#x2F;aospxref.com&#x2F;android-11.0.0_r21&#x2F; 权限配置重要的宏binder相关的selinux宏定义在system&#x2F;sepolicy&#x2F;public&#x2F;te_macros中 binder_service使用typeattribute把某个service的域(domain)标记成一个binder service域，在定义binder s">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-04-20T14:19:25.000Z">
<meta property="article:modified_time" content="2022-05-08T14:44:00.103Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2022/04/20/binder%E4%B8%AD%E7%9A%84selinux%E6%9D%83%E9%99%90/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>binder中的selinux权限 | Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/20/binder%E4%B8%AD%E7%9A%84selinux%E6%9D%83%E9%99%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          binder中的selinux权限
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-20 22:19:25" itemprop="dateCreated datePublished" datetime="2022-04-20T22:19:25+08:00">2022-04-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-05-08 22:44:00" itemprop="dateModified" datetime="2022-05-08T22:44:00+08:00">2022-05-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>基于<a href="http://aospxref.com/android-11.0.0_r21/">http://aospxref.com/android-11.0.0_r21/</a></p>
<h1 id="权限配置"><a href="#权限配置" class="headerlink" title="权限配置"></a>权限配置</h1><h2 id="重要的宏"><a href="#重要的宏" class="headerlink" title="重要的宏"></a>重要的宏</h2><p>binder相关的selinux宏定义在system&#x2F;sepolicy&#x2F;public&#x2F;te_macros中</p>
<h3 id="binder-service"><a href="#binder-service" class="headerlink" title="binder_service"></a>binder_service</h3><p>使用typeattribute把某个service的域(domain)标记成一个binder service域，在定义binder service时使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># binder_service(domain)</span><br><span class="line"># Mark a domain as being a Binder service domain.</span><br><span class="line"># Used to allow binder IPC to the various system services.</span><br><span class="line">define(`binder_service&#x27;, `</span><br><span class="line">typeattribute $1 binderservicedomain;</span><br></pre></td></tr></table></figure>

<h3 id="binder-use"><a href="#binder-use" class="headerlink" title="binder_use"></a>binder_use</h3><p>servicemanager也是一个特殊的binder服务，binder client和service都需要访问servicemanager，使用binder_use给予client和service访问servicemanager的权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># binder_use(domain)</span><br><span class="line"># Allow domain to use Binder IPC.</span><br><span class="line">define(`binder_use&#x27;, `</span><br><span class="line"># Call the servicemanager and transfer references to it.</span><br><span class="line">allow $1 servicemanager:binder &#123; call transfer &#125;;</span><br><span class="line"># Allow servicemanager to send out callbacks</span><br><span class="line">allow servicemanager $1:binder &#123; call transfer &#125;;</span><br><span class="line"># servicemanager performs getpidcon on clients.</span><br><span class="line">allow servicemanager $1:dir search;</span><br><span class="line">allow servicemanager $1:file &#123; read open &#125;;</span><br><span class="line">allow servicemanager $1:process getattr;</span><br><span class="line"># rw access to /dev/binder and /dev/ashmem is presently granted to</span><br><span class="line"># all domains in domain.te</span><br></pre></td></tr></table></figure>
<h3 id="add-service"><a href="#add-service" class="headerlink" title="add_service"></a>add_service</h3><p>给予service进程向servicemanager中注册服务的权限，在定义binder service时使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># add_service(domain, service)</span><br><span class="line"># Ability for domain to add a service to service_manager</span><br><span class="line"># and find it. It also creates a neverallow preventing</span><br><span class="line"># others from adding it.</span><br><span class="line">define(`add_service&#x27;, `</span><br><span class="line">  allow $1 $2:service_manager &#123; add find &#125;;</span><br><span class="line">  neverallow &#123; domain -$1 &#125; $2:service_manager add;</span><br><span class="line">&#x27;)</span><br></pre></td></tr></table></figure>

<h3 id="binder-call"><a href="#binder-call" class="headerlink" title="binder_call"></a>binder_call</h3><p>给予binder client访问service的权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># binder_call(clientdomain, serverdomain)</span><br><span class="line"># Allow clientdomain to perform binder IPC to serverdomain.</span><br><span class="line">define(`binder_call&#x27;, `</span><br><span class="line"># Call the server domain and optionally transfer references to it.</span><br><span class="line">allow $1 $2:binder &#123; call transfer &#125;;</span><br><span class="line"># Allow the serverdomain to transfer references to the client on the reply.</span><br><span class="line">allow $2 $1:binder transfer;</span><br><span class="line"># Receive and use open files from the server.</span><br><span class="line">allow $1 $2:fd use;</span><br><span class="line">&#x27;)</span><br></pre></td></tr></table></figure>
<h2 id="定义一个binder-service"><a href="#定义一个binder-service" class="headerlink" title="定义一个binder service"></a>定义一个binder service</h2><p>以keystore为例，binder_service、binder_user、add_service一套三连就定义完了一个binder service。要注意的是，需要为keystore在servicemanager中注册的服务，定义一个selinux标签：keystore_service，这个标签供servicemanger使用，用作binder client访问注册服务的权限控制</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// system/sepolicy/public/keystore.te</span><br><span class="line">binder_service(keystore)</span><br><span class="line">binder_use(keystore)</span><br><span class="line">add_service(keystore, keystore_service)</span><br><span class="line"></span><br><span class="line">// system/sepolicy/public/service.te</span><br><span class="line">type keystore_service,          service_manager_type;</span><br><span class="line"></span><br><span class="line">// system/sepolicy/private/service_contexts</span><br><span class="line">android.security.keystore              u:object_r:keystore_service:s0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="配置client访问service的权限"><a href="#配置client访问service的权限" class="headerlink" title="配置client访问service的权限"></a>配置client访问service的权限</h2><p>以wificond访问keystore service为例子，首先binder_use和binder_call二连，再给予wificond在servicemanger中find keystore_service的权限，不然client getService()会失败。上面小节中定义的selinux标签keystore_service的作用就在这里，它不是给binder driver用的，而是给servicemanager用的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// system/sepolicy/public/wificond.te</span><br><span class="line">binder_use(wificond)</span><br><span class="line">binder_call(wificond, keystore)</span><br><span class="line">allow wificond keystore_service:service_manager find;</span><br></pre></td></tr></table></figure>
<p>那么上面所说的这些权限是在哪里检查的呢？往下面看</p>
<h1 id="kernel中的selinux权限检查"><a href="#kernel中的selinux权限检查" class="headerlink" title="kernel中的selinux权限检查"></a>kernel中的selinux权限检查</h1><p>从内核代码中可以看出binder有impersonate、call、set_context_mgr、transfer这几种基础的权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// security/selinux/include/classmap.h</span><br><span class="line">struct security_class_mapping secclass_map[] = &#123;</span><br><span class="line">    ...</span><br><span class="line">    &#123; &quot;binder&quot;, &#123; &quot;impersonate&quot;, &quot;call&quot;, &quot;set_context_mgr&quot;, &quot;transfer&quot;, NULL &#125; &#125;,</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="set-context-mgr权限"><a href="#set-context-mgr权限" class="headerlink" title="set_context_mgr权限"></a>set_context_mgr权限</h2><p>set_context_mgr是将进程设置为binder管理进程的权限，只有servicemanager才有。对应selinux策略配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">allow servicemanager self:binder set_context_mgr;</span><br></pre></td></tr></table></figure>

<pre class="mermaid">graph TB
A(servicemanager)
B["becomeContextManager()"]
C["binder_ioctl()"]
D["binder_ioctl_set_ctx_mgr()"]
E["security_binder_set_context_mgr()"]
F["selinux_binder_set_context_mgr()"]
A-->B-->C-->D-->E-->F</pre>
<pre><code>// security/selinux/hooks.c
static int selinux_binder_set_context_mgr(const struct cred *mgr)
&#123;
    return avc_has_perm(&amp;selinux_state,
                current_sid(), cred_sid(mgr), SECCLASS_BINDER,
                BINDER__SET_CONTEXT_MGR, NULL);
&#125;
</code></pre>
<h1 id="call和impersonate权限"><a href="#call和impersonate权限" class="headerlink" title="call和impersonate权限"></a>call和impersonate权限</h1><p>call是client对service发起binder transaction需要的权限。对应selinux策略配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">allow wificond servicemanager:binder call;</span><br><span class="line">allow wificond keystore:binder call;</span><br></pre></td></tr></table></figure>
<p>impersonate这个权限比较有意思，发起binder transcation的当前进程sid和最初open &#x2F;dev&#x2F;binder的进程sid不一样，就需要impersonate权限。因为有如下场景，但是目前没有看到android里面有配置这个权限：</p>
<p>1）子进程继承父进程的binder fd，子进程和父进程的sid不一样（selinux域不同），子进程如果想使用继承binder fd发起binder transaction，就需要配置impersonate权限</p>
<p>2）进程使用sendmsg将binder fd发送给其他进程，其他进程和父进程的sid不一样（selinux域不同），其他进程如果想使用收到的binder fd发起binder transaction，就需要配置impersonate权限</p>
<pre class="mermaid">graph TB
A(wificond)
B["transact()"]
C["binder_ioctl()"]
D["binder_thread_write()"]
E["binder_transaction()"]
F["security_binder_transaction()"]
G["selinux_binder_transaction()"]
A-->B-->C-->D-->E-->F-->G</pre>
<pre><code>// security/selinux/hooks.c
static int selinux_binder_transaction(const struct cred *from,
            	      const struct cred *to)
&#123;
    u32 mysid = current_sid();
    u32 fromsid = cred_sid(from);
    u32 tosid = cred_sid(to);
    int rc;

    if (mysid != fromsid) &#123;
        rc = avc_has_perm(&amp;selinux_state,
                mysid, fromsid, SECCLASS_BINDER,
                BINDER__IMPERSONATE, NULL);
        if (rc)
            return rc;
    &#125;

    return avc_has_perm(&amp;selinux_state, fromsid, tosid,
                SECCLASS_BINDER, BINDER__CALL, NULL);
&#125;
</code></pre>
<h1 id="transfer权限"><a href="#transfer权限" class="headerlink" title="transfer权限"></a>transfer权限</h1><p>在binder transaction中传递binder对象引用时会在binder driver中做一次转换，具体参考binder_translate_binder和binder_translate_hander函数。transfer就是client、service、servicemanager之间传递binder对象引用需要的权限，比如：</p>
<p>1）service向servicemanager中注册服务时传递自己的binder引用</p>
<p>2）client向servicemanager获取服务时，servicemanager向client返回service的binder引用，</p>
<p>3）client和service之间传递binder对象引用</p>
<p>对应selinux策略配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">allow wificond servicemanager:binder transfer;</span><br><span class="line">allow keystore servicemanager:binder transfer;</span><br><span class="line">allow servicemanager keystore:binder transfer;</span><br><span class="line">allow servicemanager wificond:binder transfer;</span><br><span class="line">allow wificond keystore:binder transfer；</span><br><span class="line">allow keystore wificond:binder transfer;</span><br></pre></td></tr></table></figure>
<pre class="mermaid">graph TB
E["binder_transaction()"]
F["binder_translate_handle()"]
G["binder_translate_binder()"]
H["security_binder_transfer_binder"]
I["selinux_binder_transfer_binder"]
E-->F-->H
E-->G-->H
H-->I</pre>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// security/selinux/hooks.c</span><br><span class="line">static int selinux_binder_transfer_binder(const struct cred *from,</span><br><span class="line"> 				  const struct cred *to)</span><br><span class="line">&#123;</span><br><span class="line"> return avc_has_perm(&amp;selinux_state,</span><br><span class="line">  	    cred_sid(from), cred_sid(to),</span><br><span class="line">       SECCLASS_BINDER, BINDER__TRANSFER,</span><br><span class="line">       NULL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="fd-use-权限"><a href="#fd-use-权限" class="headerlink" title="fd use 权限"></a>fd use 权限</h1><p>binder通信也支持传递文件描述符fd，client如果要从service接受fd并使用，需要配置fd use权限。对应selinux权限配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">allow wificond keystore:fd use;</span><br></pre></td></tr></table></figure>
<pre class="mermaid">graph TB
E["binder_transaction()"]
F["binder_translate_fd()"]
G["security_binder_transfer_file()"]
H["selinux_binder_transfer_file"]
E-->F-->G-->H</pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">  // security/selinux/hooks.c</span><br><span class="line">  static int selinux_binder_transfer_file(const struct cred *from,</span><br><span class="line">			const struct cred *to,</span><br><span class="line">			struct file *file)</span><br><span class="line">  &#123;</span><br><span class="line">   u32 sid = cred_sid(to);</span><br><span class="line">   struct file_security_struct *fsec = selinux_file(file);</span><br><span class="line">   struct dentry *dentry = file-&gt;f_path.dentry;</span><br><span class="line">   struct inode_security_struct *isec;</span><br><span class="line">   struct common_audit_data ad;</span><br><span class="line">   int rc;</span><br><span class="line"></span><br><span class="line">   ad.type = LSM_AUDIT_DATA_PATH;</span><br><span class="line">   ad.u.path = file-&gt;f_path;</span><br><span class="line">      // fd use权限检查</span><br><span class="line">   if (sid != fsec-&gt;sid) &#123;</span><br><span class="line">    rc = avc_has_perm(&amp;selinux_state,</span><br><span class="line">	        sid, fsec-&gt;sid,</span><br><span class="line">		    SECCLASS_FD,</span><br><span class="line">		    FD__USE,</span><br><span class="line">		    &amp;ad);</span><br><span class="line">    if (rc)</span><br><span class="line">	    return rc;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   if (unlikely(IS_PRIVATE(d_backing_inode(dentry))))</span><br><span class="line">    return 0;</span><br><span class="line">// file_to_av ???</span><br><span class="line">   isec = backing_inode_security(denduiyyingtry);</span><br><span class="line">   return avc_has_perm(&amp;selinux_state,</span><br><span class="line">	        sid, isec-&gt;sid, isec-&gt;sclass, file_to_av(file),</span><br><span class="line">	        &amp;ad);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h1 id="servicemanager中的selinux权限检查"><a href="#servicemanager中的selinux权限检查" class="headerlink" title="servicemanager中的selinux权限检查"></a>servicemanager中的selinux权限检查</h1><p>servicemanager中主要检查：</p>
<p>1）service向servicemanager中注册服务时，servicemangaer检查service是否有注册某个服务的selinux权限，对应</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">allow keystore keystore_service:service_manager add;</span><br></pre></td></tr></table></figure>

<p>2）client向servicemanger中获取服务时，servicemanager检查client是否有获取该服务的selinux权限，对应</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">allow wificpnd keystore_service:service_manager find;</span><br></pre></td></tr></table></figure>

<p>那么servicemanager需要：</p>
<p>1）获取client和service进程的selinux域</p>
<p>2）查询selinux策略库进行selinux权限检查</p>
<h2 id="获取client和service的selinux域"><a href="#获取client和service的selinux域" class="headerlink" title="获取client和service的selinux域"></a>获取client和service的selinux域</h2><p>在binder driver中，如果目标service的txn_security_ctx标志位置为1，则获取client进程的selinux域发送给目标service。在service注册服务、client获取服务时，它们的selinux域会被发送给servicemanager</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// drivers/android/binder.c</span><br><span class="line">// 检查txn_security_ctx标志位</span><br><span class="line">if (target_node &amp;&amp; target_node-&gt;txn_security_ctx) &#123;</span><br><span class="line">	u32 secid;</span><br><span class="line">	size_t added_size;</span><br><span class="line">	// 获取sid</span><br><span class="line">	security_cred_getsecid(proc-&gt;cred, &amp;secid);</span><br><span class="line">	// sid转换成selinux域</span><br><span class="line">	ret = security_secid_to_secctx(secid, &amp;secctx, &amp;secctx_sz);</span><br><span class="line">	if (ret) &#123;</span><br><span class="line">		goto err_get_secctx_failed;</span><br><span class="line">	&#125;</span><br><span class="line">	added_size = ALIGN(secctx_sz, sizeof(u64));</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>servicemanager解析传入的selinux域</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">status_t IPCThreadState::executeCommand(int32_t cmd)</span><br><span class="line">&#123;</span><br><span class="line">    BBinder* obj;</span><br><span class="line">    RefBase::weakref_type* refs;</span><br><span class="line">    status_t result = NO_ERROR;</span><br><span class="line"></span><br><span class="line">    switch ((uint32_t)cmd) &#123;</span><br><span class="line">	...</span><br><span class="line">	case BR_TRANSACTION_SEC_CTX:</span><br><span class="line">    case BR_TRANSACTION:</span><br><span class="line">        &#123;</span><br><span class="line">            binder_transaction_data_secctx tr_secctx;</span><br><span class="line">            binder_transaction_data&amp; tr = tr_secctx.transaction_data;</span><br><span class="line"></span><br><span class="line">            if (cmd == (int) BR_TRANSACTION_SEC_CTX) &#123;</span><br><span class="line">                result = mIn.read(&amp;tr_secctx, sizeof(tr_secctx));</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                result = mIn.read(&amp;tr, sizeof(tr));</span><br><span class="line">                tr_secctx.secctx = 0;</span><br><span class="line">            &#125;</span><br><span class="line">			...</span><br><span class="line">			// 获取对方的pid</span><br><span class="line">			mCallingPid = tr.sender_pid;</span><br><span class="line">			// 获取对方的selinux域</span><br><span class="line">            mCallingSid = reinterpret_cast&lt;const char*&gt;(tr_secctx.secctx);</span><br><span class="line">            mCallingUid = tr.sender_euid;</span><br><span class="line">			...</span><br></pre></td></tr></table></figure>
<h2 id="查询selinux策略库进行selinux权限检查"><a href="#查询selinux策略库进行selinux权限检查" class="headerlink" title="查询selinux策略库进行selinux权限检查"></a>查询selinux策略库进行selinux权限检查</h2><p>addService和getService类似，以addService为例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// frameworks/native/cmds/servicemanager/ServiceManager.cpp</span><br><span class="line">Status ServiceManager::addService(const std::string&amp; name, const sp&lt;IBinder&gt;&amp; binder, ...) &#123;</span><br><span class="line">	// 获取对方的context，包括pid、selinux域、euid</span><br><span class="line">    auto ctx = mAccess-&gt;getCallingContext();</span><br><span class="line"></span><br><span class="line">    // apps cannot add services</span><br><span class="line">    if (multiuser_get_app_id(ctx.uid) &gt;= AID_APP) &#123;</span><br><span class="line">        return Status::fromExceptionCode(Status::EX_SECURITY);</span><br><span class="line">    &#125;</span><br><span class="line">	// canAdd 开始selinux权限检查</span><br><span class="line">    if (!mAccess-&gt;canAdd(ctx, name)) &#123;</span><br><span class="line">        return Status::fromExceptionCode(Status::EX_SECURITY);</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>canAdd再调用actionAllowedFromLookup</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">// frameworks/native/cmds/servicemanager/Access.cpp</span><br><span class="line">// 获取服务</span><br><span class="line">bool Access::canFind(const CallingContext&amp; ctx,const std::string&amp; name) &#123;</span><br><span class="line">    return actionAllowedFromLookup(ctx, name, &quot;find&quot;);</span><br><span class="line">&#125;</span><br><span class="line">// 注册服务</span><br><span class="line">bool Access::canAdd(const CallingContext&amp; ctx, const std::string&amp; name) &#123;</span><br><span class="line">    return actionAllowedFromLookup(ctx, name, &quot;add&quot;);</span><br><span class="line">&#125;</span><br><span class="line">// 列出服务列表</span><br><span class="line">bool Access::canList(const CallingContext&amp; ctx) &#123;</span><br><span class="line">    return actionAllowed(ctx, mThisProcessContext, &quot;list&quot;, &quot;service_manager&quot;);</span><br><span class="line">&#125;</span><br><span class="line">// 准备做权限检查</span><br><span class="line">bool Access::actionAllowedFromLookup(const CallingContext&amp; sctx, const std::string&amp; name, const char *perm) &#123;</span><br><span class="line">    char *tctx = nullptr;</span><br><span class="line">	// 查询手机中的service_contexts文件获取name对应的selinux标签</span><br><span class="line">	// name(android.security.keystore) -&gt; tctx（u:object_r:keystore_service:s0)</span><br><span class="line">    if (selabel_lookup(getSehandle(), &amp;tctx, name.c_str(), SELABEL_CTX_ANDROID_SERVICE) != 0) &#123;</span><br><span class="line">        LOG(ERROR) &lt;&lt; &quot;SELinux: No match for &quot; &lt;&lt; name &lt;&lt; &quot; in service_contexts.\n&quot;;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">	// 调用actionAllowed去做权限检查</span><br><span class="line">    bool allowed = actionAllowed(sctx, tctx, perm, name);</span><br><span class="line">    freecon(tctx);</span><br><span class="line">    return allowed;</span><br><span class="line">&#125;</span><br><span class="line">// 开始再做权限检查</span><br><span class="line">bool Access::actionAllowed(const CallingContext&amp; sctx, const char* tctx, const char* perm,</span><br><span class="line">        const std::string&amp; tname) &#123;</span><br><span class="line">	// 设置客体类型为service_manager</span><br><span class="line">    const char* tclass = &quot;service_manager&quot;;</span><br><span class="line">	// 填充audit回调数据，用于avc日志打印</span><br><span class="line">    AuditCallbackData data = &#123;</span><br><span class="line">        .context = &amp;sctx,</span><br><span class="line">        .tname = &amp;tname,</span><br><span class="line">    &#125;;</span><br><span class="line">	// 终于开始去查询selinux策略库了</span><br><span class="line">    return 0 == selinux_check_access(sctx.sid.c_str(), tctx, tclass, perm,</span><br><span class="line">        reinterpret_cast&lt;void*&gt;(&amp;data));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>selinux_check_access最终还是调用了avc_has_perm函数去做权限检查。在binder driver中调用的函数也叫avc_has_perm，只不过一个是用户态的实现，一个是内核态的实现。到这里，servicemanager的selinux权限逻辑就搞清楚。至于avc_has_perm这个函数，后面有时间的话在其他博客中写一下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">// external/selinux/libselinux/src/checkAccess.c</span><br><span class="line">int selinux_check_access(const char *scon, const char *tcon, const char *class, const char *perm, void *aux) &#123;</span><br><span class="line">	int rc;</span><br><span class="line">	security_id_t scon_id;</span><br><span class="line">	security_id_t tcon_id;</span><br><span class="line">	security_class_t sclass;</span><br><span class="line">	access_vector_t av;</span><br><span class="line"></span><br><span class="line">	__selinux_once(once, avc_init_once);</span><br><span class="line"></span><br><span class="line">	if (selinux_enabled != 1)</span><br><span class="line">		return 0;</span><br><span class="line">	// 主体(进程)selinux域转换成sid</span><br><span class="line">	rc = avc_context_to_sid(scon, &amp;scon_id);</span><br><span class="line">	if (rc &lt; 0)</span><br><span class="line">		return rc;</span><br><span class="line">	// 客体(file dir这种)selinux标签转换成sid</span><br><span class="line">	rc = avc_context_to_sid(tcon, &amp;tcon_id);</span><br><span class="line">	if (rc &lt; 0)</span><br><span class="line">		return rc;</span><br><span class="line"></span><br><span class="line">	(void) avc_netlink_check_nb();</span><br><span class="line">	// file 、dir、socket这种客体类型，这里是service_manager，goole自己扩展的</span><br><span class="line">       sclass = string_to_security_class(class);</span><br><span class="line">       if (sclass == 0) &#123;</span><br><span class="line">	       rc = errno;</span><br><span class="line">	       avc_log(SELINUX_ERROR, &quot;Unknown class %s&quot;, class);</span><br><span class="line">	       if (security_deny_unknown() == 0)</span><br><span class="line">		       return 0;</span><br><span class="line">	       errno = rc;</span><br><span class="line">	       return -1;</span><br><span class="line">       &#125;</span><br><span class="line">	// read、write这种权限，这里是add(addService)</span><br><span class="line">       av = string_to_av_perm(sclass, perm);</span><br><span class="line">       if (av == 0) &#123;</span><br><span class="line">	       rc = errno;</span><br><span class="line">	       avc_log(SELINUX_ERROR, &quot;Unknown permission %s for class %s&quot;, perm, class);</span><br><span class="line">	       if (security_deny_unknown() == 0)</span><br><span class="line">		       return 0;</span><br><span class="line">	       errno = rc;</span><br><span class="line">	       return -1;</span><br><span class="line">       &#125;</span><br><span class="line">		// 调用avc_has_perm判断是否有权限</span><br><span class="line">       return avc_has_perm (scon_id, tcon_id, sclass, av, NULL, aux);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/04/19/%E3%80%90ARM%E3%80%91adrp%E5%92%8Cadr%E6%8C%87%E4%BB%A4%E8%AF%A6%E8%A7%A3/" rel="prev" title="【ARM】adrp和adr指令详解">
      <i class="fa fa-chevron-left"></i> 【ARM】adrp和adr指令详解
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/04/24/binder%E4%B8%80%E6%AC%A1%E6%8B%B7%E8%B4%9D%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%9C%A85.10%E5%86%85%E6%A0%B8%E4%B8%8A%E7%9A%84%E5%8F%98%E5%8C%96/" rel="next" title="binder一次拷贝的实现在5.10内核上的变化">
      binder一次拷贝的实现在5.10内核上的变化 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E9%85%8D%E7%BD%AE"><span class="nav-number">1.</span> <span class="nav-text">权限配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%87%8D%E8%A6%81%E7%9A%84%E5%AE%8F"><span class="nav-number">1.1.</span> <span class="nav-text">重要的宏</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#binder-service"><span class="nav-number">1.1.1.</span> <span class="nav-text">binder_service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#binder-use"><span class="nav-number">1.1.2.</span> <span class="nav-text">binder_use</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#add-service"><span class="nav-number">1.1.3.</span> <span class="nav-text">add_service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#binder-call"><span class="nav-number">1.1.4.</span> <span class="nav-text">binder_call</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AAbinder-service"><span class="nav-number">1.2.</span> <span class="nav-text">定义一个binder service</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEclient%E8%AE%BF%E9%97%AEservice%E7%9A%84%E6%9D%83%E9%99%90"><span class="nav-number">1.3.</span> <span class="nav-text">配置client访问service的权限</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#kernel%E4%B8%AD%E7%9A%84selinux%E6%9D%83%E9%99%90%E6%A3%80%E6%9F%A5"><span class="nav-number">2.</span> <span class="nav-text">kernel中的selinux权限检查</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#set-context-mgr%E6%9D%83%E9%99%90"><span class="nav-number">2.1.</span> <span class="nav-text">set_context_mgr权限</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#call%E5%92%8Cimpersonate%E6%9D%83%E9%99%90"><span class="nav-number">3.</span> <span class="nav-text">call和impersonate权限</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#transfer%E6%9D%83%E9%99%90"><span class="nav-number">4.</span> <span class="nav-text">transfer权限</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#fd-use-%E6%9D%83%E9%99%90"><span class="nav-number">5.</span> <span class="nav-text">fd use 权限</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#servicemanager%E4%B8%AD%E7%9A%84selinux%E6%9D%83%E9%99%90%E6%A3%80%E6%9F%A5"><span class="nav-number">6.</span> <span class="nav-text">servicemanager中的selinux权限检查</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96client%E5%92%8Cservice%E7%9A%84selinux%E5%9F%9F"><span class="nav-number">6.1.</span> <span class="nav-text">获取client和service的selinux域</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2selinux%E7%AD%96%E7%95%A5%E5%BA%93%E8%BF%9B%E8%A1%8Cselinux%E6%9D%83%E9%99%90%E6%A3%80%E6%9F%A5"><span class="nav-number">6.2.</span> <span class="nav-text">查询selinux策略库进行selinux权限检查</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  













<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

</body>
</html>
